from stellar_sdk import Server, Keypair, Asset, TransactionBuilder, Network

# 1. إعداد الاتصال بخادم Pi Network (مثال للـ Testnet)
# للـ Mainnet ستحتاج لرابط خادم Pi الرسمي للشبكة الرئيسية
horizon_url = "https://api.testnet.minepi.com"
server = Server(horizon_url)

# 2. مفاتيح الحسابات (يجب أن يكون بها رصيد Pi لتغطية الرسوم)
# حساب المُصدر (الذي ينشئ العملة)
issuer_secret = "S_ISSUER_SECRET_KEY" 
issuer_kp = Keypair.from_secret(issuer_secret)

# حساب الموزع (الذي سيستقبل العملة ليعرضها في DEX)
distributor_secret = "S_DISTRIBUTOR_SECRET_KEY"
distributor_kp = Keypair.from_secret(distributor_secret)

# 3. تعريف التوكن الجديد (Asset)
asset_code = "MYPI"  # اسم التوكن الخاص بك (1-12 حرف)
my_asset = Asset(asset_code, issuer_kp.public_key)

def create_token():
    print(f"جاري إنشاء التوكن {asset_code}...")

    # أولاً: الموزع يفتح "خط ثقة" ليستقبل التوكن
    distributor_account = server.load_account(distributor_kp.public_key)
    
    trust_tx = (
        TransactionBuilder(
            source_account=distributor_account,
            network_passphrase="Pi Network Testnet", # أو اسم شبكة Pi الخاصة
            base_fee=10000 # رسوم المعاملة
        )
        .add_operation(Asset.change_trust(asset=my_asset))
        .set_timeout(30)
        .build()
    )
    trust_tx.sign(distributor_kp)
    server.submit_transaction(trust_tx)
    print("تم إنشاء خط الثقة بنجاح.")

    # ثانياً: المُصدر يرسل التوكن للموزع (عملية السك/Minting)
    issuer_account = server.load_account(issuer_kp.public_key)
    
    mint_tx = (
        TransactionBuilder(
            source_account=issuer_account,
            network_passphrase="Pi Network Testnet",
            base_fee=10000
        )
        .add_operation(
            Asset.payment(
                destination=distributor_kp.public_key,
                asset=my_asset,
                amount="1000000"  # الكمية التي تريد إنشاءها
            )
        )
        .set_timeout(30)
        .build()
    )
    mint_tx.sign(issuer_kp)
    server.submit_transaction(mint_tx)
    print(f"تم سك {asset_code} وإرسالها للموزع بنجاح!")

if __name__ == "__main__":
    create_token()
